[{"kind":1,"language":"markdown","value":"# MLSQL Module\n\nModules are how MLSQL manages dependencies which are develop by mlsql language.\n\n> It's diffrent from [mlsql-plugins](https://github.com/allwefantasy/mlsql-plugins). \n> The plugins in this project are called Java/Scala Extension because mlsql-lang is developed by Java/Scala.\n\nA module is a collection of packages that are released, versioned, and distributed together. Modules can be downloaded \ndirectly from version control repositories. We may also support module store in future.\n\nThe users can publish their owne module in `github.com` or `gitee.com`, and we can include them in our mlsql project.\n\nIn this notebook we will introduce how we can use module.\n\n## How to import module\n\nmlsql use include statement to include third-party module. \n\n```\ninclude lib.`gitee.com/allwefantasy/lib-core`\nwhere \ncommit=\"8b5a0ea7842733115f73c7748c10fb010af46537\" and\nforce=\"false\" and\nalias=\"libCore\";\n```\n\n`gitee.com/allwefantasy/lib-core` is the module name. You can specify the commit to get the target version. \nIf you want to pull the latest module code , you can set `force` as \"true\".\nalias is a ref name we can use it in later.\n\nThere are many files in mlsql module, after we include the module, we can choose the target file we want to \ninclude in our project. \n\n```\ninclude local.`libCore.dataset.vega_datasets`;\n```\n\nHowever, before include `libCore.dataset.vega_datasets`, we shoud configure some parameters to make the file works \nright.\n\n`libCore.dataset.vega_datasets` requires us set `ouputTable`, `pythonEnv` before include it. \nAnd also, it requires python package `vega_datasets` is installed.\n","outputs":[]},{"kind":2,"language":"mlsql","value":"-- set python env and include the module we want.\n!python conf \"PYTHON_ENV=source /Users/allwefantasy/opt/anaconda3/bin/activate ray1.3.0\";\n\ninclude lib.`gitee.com/allwefantasy/lib-core` where  \nalias=\"libCore\";","outputs":[]},{"kind":2,"language":"mlsql","value":"-- install vega_datasets in env ray1.3.0\n!sh script ''' \n\nsource /Users/allwefantasy/opt/anaconda3/bin/activate ray1.3.0 \npip install vega-datasets\n\n''';","outputs":[{"mime":"text/html","value":"<!DOCTYPE html>\n<html>\n<head>\n<meta http-equiv=\"Content-type\" content=\"text/html;charset=UTF-8\">\n<style>table{border-collapse:collapse; }table,td,th{border:1px dotted #ccc; padding:5px;}th {background:#444} </style>\n</head>\n<body><table>\n  <thead>\n    <tr>\n      <th>content</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td></td>\n    </tr>\n  </tbody>\n</table></body>\n</html>"}]},{"kind":2,"language":"mlsql","value":"-- use `libCore.dataset.vega_datasets` to get dumpData command.\n\nset  outputTable=\"vega_datasets\" ;\nset  pythonEnv = \"source /Users/allwefantasy/opt/anaconda3/bin/activate ray1.3.0\";\n\ninclude local.`libCore.dataset.vega_datasets`;\n\n!dumpData /tmp/veca_datasets;\n","outputs":[{"mime":"text/html","value":"<!DOCTYPE html>\n<html>\n<head>\n<meta http-equiv=\"Content-type\" content=\"text/html;charset=UTF-8\">\n<style>table{border-collapse:collapse; }table,td,th{border:1px dotted #ccc; padding:5px;}th {background:#444} </style>\n</head>\n<body><table>\n  <thead>\n    <tr>\n      <th>owner</th>\n      <th>jobType</th>\n      <th>jobName</th>\n      <th>jobContent</th>\n      <th>groupId</th>\n      <th>progress</th>\n      <th>startTime</th>\n      <th>timeout</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>admin</td>\n      <td>script</td>\n      <td>dfc8113f-b3f2-47e6-913a-d1851ccbe1ae</td>\n      <td>-- use `libCore.dataset.vega_datasets` to get dumpData command.\n\nset  outputTable=\"vega_datasets\" ;\nset  pythonEnv = \"source /Users/allwefantasy/opt/anaconda3/bin/activate ray1.3.0\";\n\ninclude local.`libCore.dataset.vega_datasets`;\n\n!dumpData /tmp/veca_datasets;\n</td>\n      <td>5b18f147-2897-4cf0-9940-02b6983498b3</td>\n      <td>[object Object]</td>\n      <td>1630316954961</td>\n      <td>-1</td>\n    </tr>\n  </tbody>\n</table></body>\n</html>"}]},{"kind":2,"language":"mlsql","value":"load parquet.`/tmp/veca_datasets` as data;\nselect count(*) from data as output;","outputs":[{"mime":"text/html","value":"<!DOCTYPE html>\n<html>\n<head>\n<meta http-equiv=\"Content-type\" content=\"text/html;charset=UTF-8\">\n<style>table{border-collapse:collapse; }table,td,th{border:1px dotted #ccc; padding:5px;}th {background:#444} </style>\n</head>\n<body><table>\n  <thead>\n    <tr>\n      <th>count(1)</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>803</td>\n    </tr>\n  </tbody>\n</table></body>\n</html>"}]}]